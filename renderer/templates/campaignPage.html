<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>The Keep on the Internet</title>
    <link rel="stylesheet" href="/static/css/borderlandkeep.css">
    <link rel="icon" type="image/x-icon" href="/assets/images/favicon.png">
    <script src="https://unpkg.com/htmx.org"></script>
    <script>
        htmx.on("htmx:swapError", function (evt) {
            console.log(evt);
        });
    function handleRedirect(event) {
    var redirectUrl = event.detail.xhr.getResponseHeader("HX-Redirect");
    if (redirectUrl) {
        console.log("redirecting")
      window.location.href = redirectUrl;
    }
  }
    </script>
</head>

<body>
    <header>
        {{ template "banner.html" }}
    </header>
    <nav>
        {{ template "nav.html" . }}
    </nav>

    <main>
        <section class="content">
            <hgroup id="campaign-details">
            {{ if .Data.OpenCampaignEditor }}
            {{ template "campaignEditor.html" . }}
            {{ else }}
                <h3>{{ .Data.Name }}</h3>
                <table>
                    <tr>
                        <td><b>Judge:</b></td>
                        <td>{{ .Data.Judge }}</td>
                    </tr>
                    <tr>
                        <td>Looking for Players?</td>
                        <td>{{ .Data.Recruitment }}</td>
                    </tr>
                    <tr>
                        <td>Last Adventure</td>
                        <td>{{ .Data.LastAdventure }}</td>
                    </tr>
                    <tr>
                        <td> Time Keeping </td>
                        <td> {{ .Data.Timekeeping }} </td>
                    </tr>
                </table>
                {{ end }}
                {{ if .Data.HasEditAccess }}
                <button hx-get="{{ .MainPath.Edit}}" hx-trigger="mousedown" hx-target="closest section" hx-swap="innerHTML">Edit Campaign</button>
                {{ end }}
            </hgroup>
        </section>
        <section class="growing-content">
            <div id="characters" class="box" hx-target="this" hx-swap="innerHTML">
                <h3>Characters</h3>
                {{ if lt .Data.NumberOfCharacters 1}}
                <div class="box" id="proj">
                    <span> No Characters Defined for this Campaign to Display </span>
                </div> {{ else }} <table>
                    <tr>
                        <th>Name</th>
                        <th>XP</th>
                        <th>Class</th>
                        <th>Level</th>
                        <th>Bonus XP</th>
                        <th>Status</th>
                    </tr> {{ range .Data.Characters }}
                    <td>{{ .Name }}</td>
                    <td>{{ .CurrentXP }}</td>
                    <td>{{ .Class }}</td>
                    <td>{{ .Level }}</td>
                    <td>{{ .PrimeReqPercent }}%</td>
                    <td>{{ .Status }}</td>
                    </tr>
                    {{ end}}
                </table>
                {{ end }}
                {{ if .Data.HasEditAccess }}
                <button hx-get="{{ .Data.CharacterPath.Edit}}" hx-trigger="mousedown">Edit Characters</button>
                {{ end }}
            </div>

            <div id="adventures">
                <div class="box">
                    <h3>Adventures</h3>
                    {{ if lt .Data.NumberOfAdventures 1}}
                    <div class="box" id="proj">
                        <span> No Characters Defined for this Campaign to Display </span>
                    </div>
                    {{ else }}
                    <table id="adventureList">
                        <tr>
                            <th>Adventure Name</th>
                            <th>Date</th>
                        </tr>
                        {{ range .Data.Adventures }}
                        <tr>
                            <td>{{ .Name }}</td>
                            <td>{{ .AdventureDate }}</td>
                            <td><a class="action-navigation" href="/adventure/{{ .Id }}"> {{ if $.Data.HasEditAccess }}Edit{{ else }}View{{end}} Details</a></td>
                            {{ if $.HasEditAccess }}<td><button class="danger" hx-delete="/adventure/{{ .Id }}" hx-target="closest tr" hx-swap="delete">Delete Adventure</button></td>{{end}}
                        </tr>
                        {{ end }}
                    </table>
                    {{ end }}
                    {{ if .Data.HasEditAccess }}
                        <button hx-disinherit="true"  hx-trigger="mousedown" hx-post="{{ .Data.AdventurePath.Display }}">Add New Adventure</button>
                        {{ end }}
                </div>
            </div>
        </section>
        {{ template "sidebar.html" . }}
    </main>
</body>

</html>